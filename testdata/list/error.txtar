# Repo without GitHub Actions
! exec ghasum list -offline no-actions/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'no such file or directory'

# Invalid workflow
! exec ghasum list -offline invalid-workflow/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'could not parse workflow'
stderr '.github/workflows/workflow.yml'

# Invalid action manifest
! exec ghasum list -offline -cache .cache/ invalid-manifest/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'could not parse manifest'
stderr 'action manifest parsing failed for actions/composite@v1'

# Invalid local action manifest
! exec ghasum init -cache .cache/ invalid-local-manifest/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'could not parse manifest'
stderr 'action manifest parsing failed for //./.github/actions/hello-world-action'

# Invalid reusable workflow
! exec ghasum list -offline -cache .cache/ invalid-reusable-workflow/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'could not parse workflow'
stderr 'reusable workflow parsing failed for actions/reusable/.github/workflows/workflow.yml@v2'

# Uses action without manifest
! exec ghasum init -cache .cache/ non-action-repository/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'could not find a manifest'
stderr 'action manifest parsing failed for non-action/repository@v1.2.3'

# Directory not found
! exec ghasum list -offline directory-not-found/
! stdout 'Ok'
stderr 'an unexpected error occurred'
stderr 'no such file or directory'

-- invalid-local-manifest/.github/actions/hello-world-action/action.yml --
name: Hello world action
description: Says 'Hello world!'

runs:
  using: composite
  steps:
- name: Say hello world
  uses: actions/github-script@v8.0.0
  with:
    script: console.log("Hello world!");
-- invalid-local-manifest/.github/workflows/workflow.yml --
name: Example workflow
on: [push]

jobs:
  example:
    name: example
    runs-on: ubuntu-24.04
    steps:
    - name: This step uses a local action
      uses: ./.github/actions/hello-world-action
-- invalid-manifest/.github/workflows/workflow.yml --
name: Example workflow
on: [push]

jobs:
  example:
    name: example
    runs-on: ubuntu-24.04
    steps:
    - name: Checkout repository
      uses: actions/composite@v1
-- invalid-reusable-workflow/.github/workflows/workflow.yml --
name: Example workflow
on: [push]

jobs:
  example:
    uses: actions/reusable/.github/workflows/workflow.yml@v2
-- invalid-workflow/.github/workflows/workflow.yml --
name: Faulty workflow
on: [push]

jobs:
  example:
    name: example
    runs-on: ubuntu-22.04
    steps:
  - name: Checkout repository
    uses: actions/checkout@v4
-- no-actions/.keep --
This file exists to create a repo that does not use GitHub Actions.
-- non-action-repository/.github/workflows/example.yml --
name: Uses a non-action repository as action
on: [push]

jobs:
  example:
    name: example
    runs-on: ubuntu-22.04
    steps:
    - uses: non-action/repository@v1.2.3
-- .cache/actions/composite/v1/action.yml --
name: actions/composite@v1
runs:
  steps:
- name: Also a direct dependency
  uses: actions/setup-go@v5
-- .cache/actions/reusable/v2/.github/workflows/workflow.yml --
name: Faulty reusable workflow
on: [workflow_dispatch]

jobs:
  example:
    name: example
    runs-on: ubuntu-24.04
    steps:
  - name: Unique transitive dependency
    uses: actions/setup-java@v4.7.1
-- .cache/actions/setup-java/v4.7.1/action.yml --
name: actions/setup-java@v4.7.1
-- .cache/non-action/repository/v1.2.3/.keep --
This file exists to have a repo that is not a GitHub Action.
